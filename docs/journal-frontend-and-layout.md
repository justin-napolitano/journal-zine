# Frontend & Layout Notes

This file breaks down the render tree, props, and styling primitives so you can quickly change UI behavior or hook in new client-side features.

## Component map

| Component | File | Responsibilities | Props |
| --- | --- | --- | --- |
| `RootLayout` | `src/app/layout.tsx` | Imports global styles, sets metadata, wraps `<html>`/`<body>` | `children` (React node)
| `JournalApp` | `src/components/JournalApp.tsx` | Core client app (search, feed, composer, infinite scroll, logout) | `initialPosts`, `initialCursor`, `isAuthed`, `initialQuery?`
| `NewPostForm` | `src/components/NewPostForm.tsx` | Composer with image upload, character counting, cross-post toggles | `onCreated(post)` callback
| `PostCard` | `src/components/PostCard.tsx` | Renders each entry as photo/link/text card and makes hashtags clickable | `post`, `onTagClick?`
| `LoginPage` | `src/app/login/page.tsx` | Admin-only password form, calls `/api/login` | *(none)*

The landing page (`src/app/page.tsx`) is a server component that fetches the first 12 posts and the auth flag, then renders `<JournalApp>`.

## Data flow between components

- `JournalApp`
  - Keeps `posts` and `cursor` in local state.
  - Observes a sentinel div to trigger `loadMore()` when near the bottom.
  - Handles search submission by calling the posts API with `q` and replacing local state entirely.
  - Tracks `loggingOut` state to disable the button and redirect to `/login` when `/api/logout` finishes.
  - Provides `handleTagClick` to `PostCard`; clicking a `#tag` injects `tag:foo` into the search string.
- `NewPostForm`
  - Reads `POST_LIMITS` from `src/lib/text.ts` to keep client-side validation in sync with the server.
  - Uses a hidden `<input type="file">` to accept one image; converts it to a data URL stored in state.
  - Sends `{ body, imageData, targets }` to `/api/posts` and invokes `onCreated` when the API echoes back the inserted row.
- `PostCard`
  - Chooses between three render modes based on `post.kind` and `post.image_data`:
    - Photo: `<img>` with `post.image_data`.
    - Link: clickable tile showing the host and body text.
    - Text: stylized paragraph.
  - Formats timestamps locally using `toLocaleString` to respect the viewer's locale.
  - Emits `onTagClick(tag)` when a hashtag pill is clicked.

## Style system (`src/app/globals.css`)

- Dark palette driven by CSS custom properties (`--bg`, `--surface`, `--accent`, etc.).
- Shared layout wrappers:
  - `.main-shell`: centers content, adds generous padding.
  - `.journal-column`: constrains feed width (560px) to match cards.
- Reusable classes:
  - `.composer-card`, `.composer-textarea`, `.composer-meta`: composer UI.
  - `.journal-search-*`: responsive search strip above the feed.
  - `.post-card`, `.post-media`, `.post-meta`, `.post-source-badge`, `.hashtag`: feed entries.
  - `.btn-primary`: accent CTA used in composer and login form.

> **Heads-up:** `globals.css` currently contains a duplicated `.composer-card` block (lines repeated with extra indentation). Cleaning it up has no functional impact but will make future editing easier.

## Interaction affordances

- **Search hints**: placeholder text and a hint label explain mini-DSL tokens (`tag:foo`, `type:photos`, `source:mastodon`).
- **Infinite scroll**: `IntersectionObserver` with `rootMargin: '200px'` gives the fetch call time to finish before the user hits the bottom.
- **Logout**: toggles text between “log out” and “logging out…” while waiting.
- **Accessibility**: Hashtag buttons are actual `<button>` elements, so they are keyboard accessible and emit events consistently.

## Extending the UI quickly

- To add filters (e.g., a dropdown for sources) without changing the API, populate `search` with tokens generated by UI controls and call `reloadWithQuery(nextQ)`.
- To add reactions/comments, extend the `Post` type and update `PostCard`—all data flows through that single prop.
- To theme differently, tweak the CSS variables at the top of `globals.css` and reuse existing class hooks.

When Codex needs to understand “which prop does what,” skim this file first, then jump into the component source with confidence.
